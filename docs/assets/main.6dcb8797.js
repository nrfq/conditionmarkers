import{O as d,g as w,b as A}from"./getPluginId.d40668cf.js";function $(e){return e.type==="IMAGE"}const k=["Blinded","Concen-trating","Charmed","Deafened","Exhausted","Frightened","Grappled","Incapaci-tated","Invisible","Paralyzed","Petrified","Poisoned","Prone","Restrained","Stunned","Un-conscious","Advantage","Baned","Bleeding Out","Blessed","Dis-advantage","Dodge","Flying","Hastened","Hexblade's Curse","Hexed","Holding Action","Hunter's Mark","Inspired","Mage Armor","Raging","Reaction Used","Armor of Agathys","Blink","Blur","Confused","Insightful Fighting","Mirror Image","On Fire","Possessed","Sanctuary","Shield of Faith","Spirit Guardians","Summoning","Symbiotic Entity","Shifted","Truesight","Warding Bond","Ancestral Protectors","Cause of Fear","Compelled Duel","Divine Favor","Highlighted","Slayer's Prey","Stabilized","Shell Defense","Bear's Endurance","Bull's Strength","Cat's Grace","Eagle's Splendor","Fox's Cunning","Owl's Wisdom"];function x(e){return e!==null&&typeof e=="object"&&e.constructor===Object}async function M(e){var a;const n=await d.player.getSelection();document.querySelectorAll(".selected-icon").forEach(s=>s.classList.remove("visible"));for(const s of e){const t=s.metadata[w("metadata")];if(x(t)&&t.enabled&&$(s)&&s.attachedTo&&(n==null?void 0:n.includes(s.attachedTo))){const i=s.name.replace("Condition Marker - ","");(a=document.getElementById(`${i}Select`))==null||a.classList.add("visible")}}}async function z(e,n,a,s){const t=await T(n,s),i={x:t.x,y:t.y},r=t.rotation,o=`https://conditiontracker.onrender.com/images/${e.toLowerCase().replace(/['-]/g,"").replace(/[ ]/g,"_")}.png`,l={width:t.size,height:t.size,mime:"image/jpg",url:o};return A(l,n.grid).scale({x:a,y:a}).rotation(r).position(i).attachedTo(n.id).locked(!0).name(`Condition Marker - ${e}`).metadata({[w("metadata")]:{enabled:!0}}).layer("ATTACHMENT").disableHit(!1).visible(n.visible).build()}function H(e,n,a,s,t){const i=e-a,r=n-s,o=t*Math.PI/180,l=i*Math.cos(o)-r*Math.sin(o),f=i*Math.sin(o)+r*Math.cos(o),c=e-l,g=n-f;return[c,g]}async function T(e,n){const a=e.image.width,s=e.image.height;let t=0,i=0,r=0,o=0;const l=await d.scene.items.getItemBounds([e.id]);if(s/a>1){const v=s/a;t=5,i=Math.round(v*5),r=l.height/i,o=s/i}else{const v=a/s;t=Math.round(v*5),i=5,r=l.width/t,o=a/t}const f=e.position.x,c=e.position.y;let g=Math.floor(n/t),p=n%t,u=f+r*p,h=c+r*g;if(e.rotation!==0){const v=H(e.position.x,e.position.y,u,h,e.rotation);u=v[0],h=v[1]}return{x:u,y:h,size:o,rotation:e.rotation}}async function N(e){const a=(await d.scene.items.getItems(t=>{const i=t.metadata[w("metadata")];return Boolean(x(i)&&i.enabled)})).filter(t=>t.attachedTo===e.id),s=[];for(let t=0;t<a.length;t++)s.push(await T(e,t));await d.scene.items.updateItems(a,t=>{for(let i=0;i<t.length;i++)t[i].position.x=s[i].x,t[i].position.y=s[i].y})}const D="/assets/blinded.7250f345.svg",R="/assets/charmed.6747b4f5.svg",F="/assets/deafened.cfa3a1fa.svg",O="/assets/exhausted.ad66f4ae.svg",j="/assets/frightened.b8c2f999.svg",G="/assets/grappled.ad2f0b0d.svg",W="/assets/incapacitated.48ea75b8.svg",U="/assets/invisible.bc96cdd6.svg",Z="/assets/paralyzed.543d0e3f.svg",J="/assets/petrified.91a5ea54.svg",K="/assets/poisoned.e5186534.svg",Q="/assets/prone.39d34e52.svg",V="/assets/restrained.6ed70c34.svg",X="/assets/stunned.14710c91.svg",Y="/assets/unconscious.66729f2f.svg",ee="/assets/baned.05c8e468.svg",se="/assets/blessed.ff35a551.svg",te="/assets/concentrating.9b6567de.svg",ne="/assets/dodge.faaa2f6a.svg",ae="/assets/hastened.0f7a5a6b.svg",ie="/assets/hexed.8b7fa58e.svg",oe="/assets/holding_action.737fc682.svg",ce="/assets/hunters_mark.c71f1644.svg",re="/assets/raging.d39e6d5b.svg",de="/assets/reaction_used.46275410.svg",le="/assets/advantage.95384eb3.svg",ue="/assets/bleeding_out.98c45611.svg",ge="/assets/disadvantage.aad6b01e.svg",fe="/assets/flying.6914a6e5.svg",me="/assets/hexblades_curse.ee294e37.svg",he="/assets/inspired.64843c6e.svg",ve="/assets/mage_armor.0a02a25d.svg",be="/assets/armor_of_agathys.8118c432.svg",pe="/assets/blink.950b023e.svg",ye="/assets/blur.74cade0f.svg",_e="/assets/confused.b6097d2c.svg",ke="/assets/insightful_fighting.d39393f0.svg",we="/assets/mirror_image.9249b7b0.svg",Se="/assets/on_fire.60017798.svg",Ce="/assets/possessed.a8978807.svg",Ie="/assets/sanctuary.8506fe56.svg",Me="/assets/shield_of_faith.1fed7c30.svg",Le="/assets/spirit_guardians.12ef9f47.svg",xe="/assets/summoning.0e3d3d66.svg",Ee="/assets/symbiotic_entity.037af987.svg",Be="/assets/shifted.2023d3f1.svg",Te="/assets/truesight.64e18689.svg",qe="/assets/warding_bond.cefa8b3d.svg",Pe="/assets/ancestral_protectors.0561dd23.svg",Ae="/assets/cause_of_fear.3bda3a20.svg",$e="/assets/compelled_duel.05c83d9b.svg",ze="/assets/divine_favor.d75322e3.svg",He="/assets/highlighted.5ddf23be.svg",Ne="/assets/slayers_prey.ae18e854.svg",De="/assets/stabilized.777285ef.svg",Re="/assets/shell_defense.b99d7a39.svg",Fe="/assets/bears_endurance.e5cd1a3c.svg",Oe="/assets/bulls_strength.e5abe3ff.svg",je="/assets/cats_grace.da97481a.svg",Ge="/assets/eagles_splendor.2b35c6a7.svg",We="/assets/foxs_cunning.d11091e6.svg",Ue="/assets/owls_wisdom.339a8c1e.svg",Ze="/assets/left.fdde412f.svg",Je="/assets/right.cc5db9f3.svg",Ke="/assets/close.adf8672f.svg",Qe="/assets/error.4d98ffa5.svg";function I(e){switch(e.toLowerCase().replace(/['-]/g,"").replace(/[ ]/g,"_")){case"blinded":return D;case"charmed":return R;case"deafened":return F;case"frightened":return j;case"exhausted":return O;case"grappled":return G;case"incapacitated":return W;case"invisible":return U;case"paralyzed":return Z;case"petrified":return J;case"poisoned":return K;case"prone":return Q;case"restrained":return V;case"stunned":return X;case"unconscious":return Y;case"baned":return ee;case"blessed":return se;case"concentrating":return te;case"dodge":return ne;case"hastened":return ae;case"hexed":return ie;case"holding_action":return oe;case"hunters_mark":return ce;case"raging":return re;case"reaction_used":return de;case"left":return Ze;case"right":return Je;case"advantage":return le;case"disadvantage":return ge;case"bleeding_out":return ue;case"flying":return fe;case"hexblades_curse":return me;case"inspired":return he;case"mage_armor":return ve;case"armor_of_agathys":return be;case"blink":return pe;case"blur":return ye;case"confused":return _e;case"insightful_fighting":return ke;case"mirror_image":return we;case"on_fire":return Se;case"possessed":return Ce;case"sanctuary":return Ie;case"shield_of_faith":return Me;case"spirit_guardians":return Le;case"summoning":return xe;case"symbiotic_entity":return Ee;case"shifted":return Be;case"truesight":return Te;case"warding_bond":return qe;case"ancestral_protectors":return Pe;case"cause_of_fear":return Ae;case"compelled_duel":return $e;case"divine_favor":return ze;case"highlighted":return He;case"slayers_prey":return Ne;case"stabilized":return De;case"shell_defense":return Re;case"bears_endurance":return Fe;case"bulls_strength":return Oe;case"cats_grace":return je;case"eagles_splendor":return Ge;case"foxs_cunning":return We;case"owls_wisdom":return Ue;case"close":return Ke;default:return Qe}}const m=16;let S=1,C=k.slice(0,m);d.onReady(async()=>{const e=document.querySelector("#app");e&&(e.innerHTML=`
      <div class="conditions">
        <div class="search-area">
          <input class="condition-filter" placeholder="Filter" type="search" id="search-bar"></input>
          <div class="clear-button-div">
            <button class="clear-button" tabindex="-1" type="button" aria-label="Clear" title="Clear">
              <img class="clear-button-img" src="${I("close")}"/>
            </button>
          </div>
        </div>
        <div class="lower-flex">
          <div class="page-left disabled">
            <img class="page-icon" src="${I("left")}"/>
          </div>
          <div class="conditions-area">
          </div>
          <div class="page-right">
            <img class="page-icon" src="${I("right")}"/>
          </div>
        </div>
      </div>
    `),q();const n=document.querySelector(".condition-filter"),a=document.querySelector(".clear-button");n&&n.addEventListener("input",()=>{n.value!==""&&a?a.style.visibility="visible":a&&(a.style.visibility="hidden"),B(n.value)}),a&&n&&a.addEventListener("click",()=>{n.value="",B(n.value),a.style.visibility="hidden",_()});const s=document.querySelector(".page-left"),t=document.querySelector(".page-right");s&&s.addEventListener("click",r=>{r&&r.target&&!r.target.classList.contains("disabled")&&S>1&&(S-=1,E()),_()}),t&&t.addEventListener("click",r=>{r&&r.target&&!r.target.classList.contains("disabled")&&S<4&&(S+=1,E()),_()});const i=await d.scene.items.getItems();M(i),d.scene.items.onChange(M),_(),document.addEventListener("keydown",r=>{var o;r.key=="Escape"&&(((o=document.activeElement)==null?void 0:o.id)==="search-bar"?d.popover.close(w("condition-markers")):_())})});async function q(){const e=document.querySelector(".conditions-area");if(e){e.innerHTML=`
        ${C.map(s=>`<button class="condition-button" id="${s}">
                <div class="condition">
                  <img src="${I(s)}"/>
                </div>
                <div class="selected-icon" id="${s}Select"></div>
                <div class="condition-name"><p>${s}</p></div>
              </button>`).join("")}
    `,document.querySelectorAll(".condition-button").forEach(s=>{s.addEventListener("click",()=>{P(s)}),s.addEventListener("mouseover",()=>{const t=s.querySelector(".condition-name");t&&(t.style.visibility="visible")}),s.addEventListener("mouseout",()=>{const t=s.querySelector(".condition-name");t&&(t.style.visibility="hidden")})});const a=await d.scene.items.getItems();M(a)}}function E(){const e=document.querySelector(".page-left"),n=document.querySelector(".page-right");if(e&&n){switch(S){case 1:L(e),y(n),C=k.slice(0,m);break;case 2:y(e),y(n),C=k.slice(m,m*2);break;case 3:y(e),y(n),C=k.slice(m*2,m*3);break;case 4:y(e),L(n),C=k.slice(m*3,m*4);break}q()}}function L(e){e&&e.classList.add("disabled")}function y(e){e&&e.classList.remove("disabled")}async function B(e){if(e.length===0){E();return}L(document.querySelector(".page-left")),L(document.querySelector(".page-right"));const n=document.querySelector(".conditions-area"),a=[],s=await d.player.getSelection(),t=await d.scene.items.getItems(s),i=await d.scene.items.getItems(o=>{const l=o.metadata[w("metadata")];return Boolean(x(l)&&l.enabled)});let r=[];for(const o of t)r=i.filter(l=>l.attachedTo===o.id);for(const o of k){if(o.toLowerCase().replace("-","").replace("'","").includes(e.toLowerCase())){const c=document.createElement("button");c.className="condition-button",c.id=o;const g=document.createElement("div");g.className="condition";const p=document.createElement("img");p.setAttribute("src",I(o)),g.appendChild(p),c.appendChild(g);const u=document.createElement("div");u.className="selected-icon",u.id=`${o}Select`;const h=document.createElement("div");h.className="condition-name",h.innerHTML=`<p>${o}</p>`,c.appendChild(u),c.appendChild(h),c.addEventListener("click",()=>{P(c)}),c.addEventListener("mouseover",()=>{const b=c.querySelector(".condition-name");b&&(b.style.visibility="visible")}),c.addEventListener("mouseout",()=>{const b=c.querySelector(".condition-name");b&&(b.style.visibility="hidden")}),r.filter(b=>b.name.includes(o)).length!==0&&(u.style.visibility="visible"),a.push(c)}document.querySelectorAll(".condition-button").forEach(c=>{n==null||n.removeChild(c)}),a.forEach(c=>{n==null||n.appendChild(c)});const f=await d.scene.items.getItems();M(f)}}async function P(e){const n=e.id;let a=!1;const s=e.querySelector(".selected-icon");s&&s.classList.contains("visible")&&(a=!0);const t=await d.player.getSelection();if(t){const i=[],r=[],o=[],l=await d.scene.items.getItems(t),f=await d.scene.items.getItems(c=>{const g=c.metadata[w("metadata")];return Boolean(x(g)&&g.enabled)});for(const c of l){const g=f.filter(u=>u.attachedTo===c.id),p=g.filter(u=>u.name.includes(n));a?(r.push(...p.map(u=>u.id)),s&&(s.style.visibility="hidden",s.classList.remove("visible")),o.push(c)):(s&&(s.style.visibility="visible",s.classList.add("visible")),i.push(await z(n,c,c.scale.x,g.length)))}i.length>0&&await d.scene.items.addItems(i),r.length>0&&await d.scene.items.deleteItems(r);for(const c of o)N(c)}_()}function _(){var e;(e=document.getElementById("search-bar"))==null||e.select()}
